{% extends "layout.html" %}

{% block content %}
<div class="space-y-8">

    <!-- Header -->
    <div class="border-b border-surface-700 pb-6">
        <div class="flex items-center gap-3 mb-2">
            <i data-lucide="book-a" class="w-5 h-5 text-copper-600"></i>
            <p class="text-sm font-sans font-medium text-copper-600 tracking-wide uppercase">Library</p>
        </div>
        <h1 class="font-serif text-3xl text-surface-100">Synonym Library</h1>
        <p class="mt-2 font-sans text-surface-400 text-sm">Manage search term synonyms to improve query matching</p>
    </div>

    <!-- Status Messages -->
    <div id="synonym-status-messages">
        {% if success_message %}
        <div class="p-4 bg-surface-900 border border-green-700/50 rounded-lg">
            <div class="flex items-center gap-2">
                <i data-lucide="check-circle" class="w-4 h-4 text-green-600 flex-shrink-0"></i>
                <p class="font-sans text-sm text-green-400">{{ success_message }}</p>
            </div>
        </div>
        {% endif %}

        {% if errors %}
        <div class="p-4 bg-surface-900 border border-red-800/50 rounded-lg">
            <div class="flex items-start gap-2">
                <i data-lucide="alert-circle" class="w-4 h-4 text-red-500 mt-0.5 flex-shrink-0"></i>
                <div>
                    {% for error in errors %}
                    <p class="font-sans text-sm text-red-400">{{ error }}</p>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Stats Overview -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-surface-800 border border-surface-700 rounded-lg p-5">
            <div class="flex items-center justify-between">
                <div>
                    <p class="font-sans text-xs text-surface-400 uppercase tracking-wide">Built-in Terms</p>
                    <p class="font-sans text-2xl font-semibold text-surface-100 mt-1">{{ builtin_count }}</p>
                </div>
                <div class="p-2.5 bg-surface-900 border border-surface-700 rounded-lg">
                    <i data-lucide="lock" class="w-5 h-5 text-surface-400"></i>
                </div>
            </div>
        </div>

        <div class="bg-surface-800 border border-surface-700 rounded-lg p-5">
            <div class="flex items-center justify-between">
                <div>
                    <p class="font-sans text-xs text-surface-400 uppercase tracking-wide">Custom Terms</p>
                    <p class="font-sans text-2xl font-semibold text-copper-600 mt-1">{{ custom_count }}</p>
                </div>
                <div class="p-2.5 bg-copper-900/20 border border-copper-700 rounded-lg">
                    <i data-lucide="plus" class="w-5 h-5 text-copper-500"></i>
                </div>
            </div>
        </div>

        <div class="bg-surface-800 border border-surface-700 rounded-lg p-5">
            <div class="flex items-center justify-between">
                <div>
                    <p class="font-sans text-xs text-surface-400 uppercase tracking-wide">Total Active</p>
                    <p class="font-sans text-2xl font-semibold text-surface-100 mt-1">{{ total_count }}</p>
                </div>
                <div class="p-2.5 bg-surface-900 border border-surface-700 rounded-lg">
                    <i data-lucide="check-circle" class="w-5 h-5 text-green-600"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Single Synonym Form -->
    <div class="bg-surface-800 border border-surface-700 rounded-lg p-6">
        <h2 class="font-serif text-lg text-surface-100 mb-5 flex items-center gap-2">
            <i data-lucide="plus" class="w-5 h-5 text-copper-600"></i>
            Add New Synonym
        </h2>

        <form hx-post="/admin/synonyms/add"
              hx-target="#custom-synonyms-list"
              hx-swap="outerHTML"
              class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">

            <div>
                <label class="block font-sans text-sm font-medium text-surface-200 mb-1">Canonical Term</label>
                <input type="text"
                       name="canonical_term"
                       placeholder="e.g., vacation"
                       required
                       class="w-full px-3 py-2 border border-surface-600 rounded-lg bg-surface-800 font-sans text-sm focus:border-copper-500 focus:ring-0" />
                <p class="mt-1 font-sans text-xs text-surface-400">The main term</p>
            </div>

            <div>
                <label class="block font-sans text-sm font-medium text-surface-200 mb-1">Synonyms (comma-separated)</label>
                <input type="text"
                       name="synonyms"
                       placeholder="e.g., pto, time off, annual leave"
                       required
                       class="w-full px-3 py-2 border border-surface-600 rounded-lg bg-surface-800 font-sans text-sm focus:border-copper-500 focus:ring-0" />
                <p class="mt-1 font-sans text-xs text-surface-400">Related terms that should match</p>
            </div>

            <div>
                <button type="submit"
                        class="w-full px-4 py-2 bg-copper-600 hover:bg-copper-700 text-white font-sans text-sm font-medium rounded-lg transition-colors inline-flex items-center justify-center gap-2">
                    <i data-lucide="plus" class="w-4 h-4"></i>
                    Add Synonym
                </button>
            </div>
        </form>
    </div>

    <!-- Custom Synonyms List -->
    <div id="custom-synonyms-list" class="bg-surface-800 border border-surface-700 rounded-lg p-6">
        <div class="flex items-center justify-between mb-5">
            <h2 class="font-serif text-lg text-surface-100 flex items-center gap-2">
                <i data-lucide="plus" class="w-5 h-5 text-copper-600"></i>
                Custom Synonyms ({{ custom_count }})
            </h2>
            <div class="flex gap-2">
                <a href="/admin/synonyms/download?include_builtin=false"
                   class="px-3 py-1.5 bg-surface-900 text-surface-300 font-sans text-xs font-medium rounded-lg hover:bg-surface-700 border border-surface-700 transition-colors inline-flex items-center gap-1">
                    <i data-lucide="download" class="w-3.5 h-3.5"></i>
                    Download
                </a>
                <button hx-post="/admin/synonyms/reload"
                        hx-target="#synonym-status-messages"
                        hx-swap="innerHTML"
                        class="px-3 py-1.5 bg-surface-900 text-surface-300 font-sans text-xs font-medium rounded-lg hover:bg-surface-700 border border-surface-700 transition-colors inline-flex items-center gap-1">
                    <i data-lucide="refresh-cw" class="w-3.5 h-3.5"></i>
                    Reload Cache
                </button>
            </div>
        </div>

        {% if custom_synonyms %}
        <div class="overflow-x-auto">
            <table class="w-full font-sans text-sm">
                <thead>
                    <tr class="text-left text-surface-400 border-b border-surface-700">
                        <th class="pb-3 font-medium text-xs uppercase tracking-wide">Canonical Term</th>
                        <th class="pb-3 font-medium text-xs uppercase tracking-wide">Synonyms</th>
                        <th class="pb-3 font-medium text-xs uppercase tracking-wide w-20">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-surface-700">
                    {% for canonical, syns in custom_synonyms.items() %}
                    <tr class="hover:bg-surface-700">
                        <td class="py-3 font-medium text-surface-100">{{ canonical }}</td>
                        <td class="py-3 text-surface-300">
                            {% for syn in syns %}
                            <span class="inline-block px-2 py-0.5 bg-copper-900/20 text-copper-400 text-xs rounded border border-copper-800 mr-1 mb-1">{{ syn }}</span>
                            {% endfor %}
                        </td>
                        <td class="py-3">
                            <button hx-delete="/admin/synonyms/{{ canonical }}"
                                    hx-target="#custom-synonyms-list"
                                    hx-swap="outerHTML"
                                    hx-confirm="Delete synonym '{{ canonical }}'?"
                                    class="text-red-500 hover:text-red-400 transition-colors inline-flex items-center gap-1">
                                <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="font-sans text-surface-400 text-sm">No custom synonyms defined yet. Add your first synonym above.</p>
        {% endif %}
    </div>

    <!-- Built-in Synonyms (Read-only) -->
    <div class="bg-surface-800 border border-surface-700 rounded-lg p-6">
        <div class="flex items-center justify-between mb-5">
            <h2 class="font-serif text-lg text-surface-100 flex items-center gap-2">
                <i data-lucide="lock" class="w-5 h-5 text-surface-400"></i>
                Built-in Synonyms ({{ builtin_count }})
                <span class="font-sans text-xs font-normal text-surface-400 ml-1">(read-only)</span>
            </h2>
            <a href="/admin/synonyms/download?include_builtin=true"
               class="px-3 py-1.5 bg-surface-900 text-surface-300 font-sans text-xs font-medium rounded-lg hover:bg-surface-700 border border-surface-700 transition-colors inline-flex items-center gap-1">
                <i data-lucide="download" class="w-3.5 h-3.5"></i>
                Download All
            </a>
        </div>

        <div class="overflow-x-auto max-h-96 overflow-y-auto">
            <table class="w-full font-sans text-sm">
                <thead class="sticky top-0 bg-surface-800">
                    <tr class="text-left text-surface-400 border-b border-surface-700">
                        <th class="pb-3 font-medium text-xs uppercase tracking-wide">Canonical Term</th>
                        <th class="pb-3 font-medium text-xs uppercase tracking-wide">Synonyms</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-surface-700">
                    {% for canonical, syns in builtin_synonyms.items() %}
                    <tr class="hover:bg-surface-700">
                        <td class="py-3 font-medium text-surface-100">{{ canonical }}</td>
                        <td class="py-3 text-surface-300">
                            {% for syn in syns %}
                            <span class="inline-block px-2 py-0.5 bg-surface-800 text-surface-300 text-xs rounded border border-surface-700 mr-1 mb-1">{{ syn }}</span>
                            {% endfor %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>
{% endblock %}
